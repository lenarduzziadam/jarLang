# Test that the testlib helpers work correctly
# Imports stdlib for functions, and testlib for assertions

summon "../stdlib.vase"
summon "testlib.vase"

# Reset counters
test_reset()

# Numeric assertions
assert_eq(10, max(10,5), "max basic")
assert_eq(7, min(10,5), "min basic")
assert_eq(10, clamp(15,1,10), "clamp basic")
assert_eq(-5, commune(2,3), "commune")
assert_eq(3, banish(5,2), "banish")
assert_eq(12, rally(3,4), "rally")
assert_eq(5, slash(10,2), "slash")
assert_eq(8, ascend(2,3), "ascend")
assert_eq(720, fact(6), "fact")
assert_eq(55, fib(10), "fib")
assert_eq(1024, pow_int(2,10), "pow_int")
assert_eq(1, is_prime(97), "prime check")

# String assertions
assert_eq("foobar", concat("foo","bar"), "concat")
assert_eq("hahaha", tale_repeat("ha", 3), "repeat")

# Approx equality
assert_true(approx_equal_tol(0.1 + 0.2, 0.3), "approx tol true")

# Variable/testlib counters behavior
wield before_passes TEST_PASSES
wield before_fails TEST_FAILS
chant "before: passes=" + before_passes + " fails=" + before_fails

# Print a test summary and capture failures
wield failures test_summary()
chant "after summary (failures): " + failures

# End
